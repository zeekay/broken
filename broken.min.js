!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Broken=e()}(this,function(){"use strict";var t,e,n=t=function(){function t(t){this.state=t.state,this.value=t.value,this.reason=t.reason}return t.prototype.isFulfilled=function(){return"fulfilled"===this.state},t.prototype.isRejected=function(){return"rejected"===this.state},t}(),r=void 0,o="undefined";e=function(){var t,e,n,i,u;return i=[],u=0,t=1024,e=function(){for(var e;i.length-u;){try{i[u]()}catch(n){e=n,global.console&&global.console.error(e)}i[u++]=r,u===t&&(i.splice(0,t),u=0)}},n=function(){var t,n;return typeof MutationObserver!==o?(t=document.createElement("div"),n=new MutationObserver(e),n.observe(t,{attributes:!0}),function(){t.setAttribute("a",0)}):typeof setImmediate!==o?function(){setImmediate(e)}:function(){setTimeout(e,0)}}(),function(t){i.push(t),i.length-u===1&&n()}}();var i,u,c,f,s,l,a,h=e;s=void 0,c=s,u="fulfilled",f="rejected",a=function(t,e){var n,r;if("function"==typeof t.y)try{r=t.y.call(s,e),t.p.resolve(r)}catch(o){n=o,t.p.reject(n)}else t.p.resolve(e)},l=function(t,e){var n,r;if("function"==typeof t.n)try{r=t.n.call(s,e),t.p.resolve(r)}catch(o){n=o,t.p.reject(n)}else t.p.reject(e)},i=function(){function t(t){t&&t(function(t){return function(e){return t.resolve(e)}}(this),function(t){return function(e){return t.reject(e)}}(this))}return t.prototype.resolve=function(t){var e,n,r,o;if(this.state===c){if(t===this)return this.reject(new TypeError("Attempt to resolve promise with self"));if(t&&("function"==typeof t||"object"==typeof t))try{if(r=!0,o=t.then,"function"==typeof o)return void o.call(t,function(t){return function(e){r&&(r&&(r=!1),t.resolve(e))}}(this),function(t){return function(e){r&&(r=!1,t.reject(e))}}(this))}catch(i){return n=i,void(r&&this.reject(n))}this.state=u,this.v=t,(e=this.c)&&h(function(n){return function(){var n,r,o;for(r=0,o=e.length;o>r;r++)n=e[r],a(n,t)}}(this))}},t.prototype.reject=function(e){var n;this.state===c&&(this.state=f,this.v=e,(n=this.c)?h(function(){var t,r,o;for(r=0,o=n.length;o>r;r++)t=n[r],l(t,e)}):!t.suppressUncaughtRejectionError&&global.console&&global.console.log("Broken Promise, please catch rejections: ",e,e?e.stack:null))},t.prototype.then=function(e,n){var r,o,i,f;return i=new t,o={y:e,n:n,p:i},this.state===c?this.c?this.c.push(o):this.c=[o]:(f=this.state,r=this.v,h(function(){f===u?a(o,r):l(o,r)})),i},t.prototype["catch"]=function(t){return this.then(null,t)},t.prototype["finally"]=function(t){return this.then(t,t)},t.prototype.timeout=function(e,n){return n=n||"timeout",new t(function(t){return function(r,o){setTimeout(function(){return o(Error(n))},e),t.then(function(t){r(t)},function(t){o(t)})}}(this))},t.prototype.callback=function(t){return"function"==typeof t&&(this.then(function(e){return t(null,e)}),this["catch"](function(e){return t(e,null)})),this},t}();var p=i,v=function(t){var e;return e=new p,e.resolve(t),e},y=function(t){var e;return e=new p,e.reject(t),e},d=function(t){var e,n,r,o,i,u,c,f;for(c=[],i=0,f=new p,u=function(e,n){e&&"function"==typeof e.then||(e=v(e)),e.then(function(e){c[n]=e,i++,i===t.length&&f.resolve(c)},function(t){f.reject(t)})},e=n=0,r=t.length;r>n;e=++n)o=t[e],u(o,e);return t.length||f.resolve(c),f},j=function(t){return new p(function(e,r){return t.then(function(t){return e(new n({state:"fulfilled",value:t}))})["catch"](function(t){return e(new n({state:"rejected",reason:t}))})})},m=function(t){return d(t.map(j))};return p.all=d,p.reflect=j,p.reject=y,p.resolve=v,p.settle=m,p.soon=h,p});
